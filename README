BUILD
=====

Install libusb-1.0 and its development files and run:

    $ make

For cross-compilation for win32/64 you need to install libusb-1.0
and mman-win32. See at the end of this document for more information.
After that, you can run:

    $ make MACH=mingw CROSSPREFIX=i686-w64-mingw32-

    or

    $ make MACH=mingw CROSSPREFIX=x86_64-w64-mingw32-


USAGE
=====

Read parameters:

sudo ./rkflashtool p > parm.bin
cat parm.bin

The output will show 2 hex numbers and the partition name.
(....,0x00008000@0x00010000(recovery),....)
The first number is the size of the partition, the second number is the
offset. So, to write the recovery image, use:

sudo ./rkflashtool w 0x10000 0x8000 < recovery.img


All available commands:

rkflashtool b                         reboot device
rkflashtool r offset size >file       read flash
rkflashtool w offset size <file       write flash

rkflashtool m offset size >file       read 0x80 bytes DRAM
rkflashtool i offset blocks >file     read IDB flash
rkflashtool p >file                   fetch parameters

rkflashtool e offset size             erase flash (fill with 0xff)

offset and size are in units (blocks) of 512 bytes (!)



Also included:



rkcrc           sign files with a cyclic redundency code and optionally
                add a KRNL or PARM + size header

usage: rkcrc [-k|-p] infile outfile



rkparameters    generate a parameter file

usage: rkparameters model fw_version partitionsfile

    model is found in the large case statement, e.g. arnova7g2
    you can add your own and please send the information back to me
    (ivop@euronet.nl) for inclusion in future versions.

    fw_version is the version number, e.g. 1.2.3

    partitionsfile is a file that specifies the kernel command line on the
    first line and describes all the partitions and their sizes. It skips
    the parameters block and starts with misc. See the example mtdparts.txt
    for details.



rkparametersblock   generate the parameters block

usage: rkparametersblock parametersfile outfile

    parametersfile is the file you have generated with rkparameters.
    outfile is the file to be written, which can later be flashed to your
    device.
    rkparametersblock needs rkcrc to sign the parameter file. After that,
    it generates an empty 4MB file and pastes in the rkcrc'd file five times
    at the start of the first five NAND pages (it assumes the NAND page size
    is always 4096. Let me know if you run into something different).



rkunpack        unpack update.img files (not partition.img (!))

usage: rkunpack file

    supports both RKAF and RKFW (which contains an embedded RKAF file)




Notes on cross-compiling libusb-1.0 and mman-win32 on debian wheezy:

sudo apt-get install mingw-w64

git clone http://git.libusb.org/libusb.git
cd libusb
./autogen.sh
make clean
./configure --host i686-w64-mingw32 --prefix=/usr/i686-w64-mingw32
make
sudo make install

svn checkout http://mman-win32.googlecode.com/svn/trunk/ mman-win32
cd mman-win32
./configure --cross-prefix=i686-w64-mingw32- --prefix=/usr/i686-w64-mingw32 --libdir=/usr/i686-w64-mingw32/lib --incdir=/usr/i686-w64-mingw32/include
make
sudo make install
cd /usr/i686-w64-mingw32/include/sys
ln -s ../mman.h


Replace i686-w64-mingw32 with x86_64-w64-mingw32 to do a win64 build.

